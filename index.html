<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>연령별 수납액 통계</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h2 { color: #2c3e50; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f4f4f4; }
  </style>
</head>
<body>
  <h2>연령별 수납액 통계</h2>
  <input type="file" id="fileInput" accept=".xlsx" />
  <table id="resultTable" style="display:none">
    <thead>
      <tr>
        <th>연령대</th>
        <th>총 수납액</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
  document.getElementById('fileInput').addEventListener('change', function(e) {
    const reader = new FileReader();
    reader.onload = function(e) {
      const data = new Uint8Array(e.target.result);
      const workbook = XLSX.read(data, { type: 'array' });
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      const json = XLSX.utils.sheet_to_json(sheet, { header: 1 }); // 2차원 배열로 가져옴

      const rows = json.filter(r => r.length >= 3); // 최소 열 3개 필요 (성별, 나이, 수납액)

      const result = {
        '10대': 0, '20대': 0, '30대': 0, '40대': 0,
        '50대': 0, '60대': 0, '70대': 0, '80대': 0
      };

      rows.forEach(row => {
        const age = parseInt(row[1]);
        const amount = parseInt(row[2].toString().replace(/,/g, '') || 0);
        if (isNaN(age) || isNaN(amount)) return;

        if (age < 20) result['10대'] += amount;
        else if (age < 30) result['20대'] += amount;
        else if (age < 40) result['30대'] += amount;
        else if (age < 50) result['40대'] += amount;
        else if (age < 60) result['50대'] += amount;
        else if (age < 70) result['60대'] += amount;
        else if (age < 80) result['70대'] += amount;
        else result['80대'] += amount;
      });

      const tbody = document.querySelector('#resultTable tbody');
      tbody.innerHTML = '';
      let grandTotal = 0;

      Object.entries(result).forEach(([age, total]) => {
        grandTotal += total;
        const row = `<tr><td>${age}</td><td>${total.toLocaleString()}</td></tr>`;
        tbody.insertAdjacentHTML('beforeend', row);
      });

      tbody.insertAdjacentHTML('beforeend', `<tr style="font-weight:bold">
        <td>합계</td><td>${grandTotal.toLocaleString()}</td></tr>`);

      document.getElementById('resultTable').style.display = 'table';
    };
    reader.readAsArrayBuffer(e.target.files[0]);
  });
</script>

</body>
</html>
